# Sprint 2 Week 4 Day 1-3: å‰ç«¯ä¼˜åŒ–ç•Œé¢å¼€å‘ - åŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2024å¹´12æœˆ  
**å¼€å‘å‘¨æœŸ**: Sprint 2 Week 4 Day 1-3  
**è´Ÿè´£æ¨¡å—**: å‰ç«¯å¼€å‘  
**ä¾èµ–é¡¹ç›®**: Sprint 2 Week 3åç«¯æ ¸å¿ƒä¼˜åŒ–ç®—æ³•  

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### ä¸»è¦ç›®æ ‡

å®ç°AIæç¤ºè¯ä¼˜åŒ–å™¨çš„å‰ç«¯æ ¸å¿ƒç•Œé¢ï¼Œä¸ºç”¨æˆ·æä¾›ç›´è§‚ã€é«˜æ•ˆçš„æç¤ºè¯ä¼˜åŒ–ä½“éªŒã€‚é‡ç‚¹å¼€å‘æç¤ºè¯è¾“å…¥ç»„ä»¶ã€ä¼˜åŒ–ç»“æœå±•ç¤ºç»„ä»¶ã€å‰åå¯¹æ¯”ç•Œé¢å’Œè´¨é‡è¯„åˆ†å¯è§†åŒ–åŠŸèƒ½ã€‚

### åŠŸèƒ½èŒƒå›´

**æœ¬æœŸå¼€å‘å†…å®¹**:
- æç¤ºè¯è¾“å…¥ç»„ä»¶ (Day 1)
- ä¼˜åŒ–ç»“æœå±•ç¤ºç»„ä»¶ (Day 2)  
- å‰åå¯¹æ¯”ç•Œé¢ (Day 3)
- è´¨é‡è¯„åˆ†å¯è§†åŒ– (Day 1-3)

**æš‚ä¸åŒ…å«**:
- ç”¨æˆ·è®¤è¯ç•Œé¢ï¼ˆå·²åœ¨Sprint 1å®Œæˆï¼‰
- å†å²è®°å½•åŠŸèƒ½ï¼ˆSprint 3å¼€å‘ï¼‰
- é«˜çº§è®¾ç½®åŠŸèƒ½ï¼ˆåç»­ç‰ˆæœ¬ï¼‰

## ğŸ— æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             React 18                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          TypeScript 5               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Ant Design 5                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Zustand (çŠ¶æ€ç®¡ç†)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Axios (HTTPå®¢æˆ·ç«¯)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    React Query (æ•°æ®è·å–)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶æ¶æ„è®¾è®¡

```
OptimizationPage (ä¼˜åŒ–ä¸»é¡µé¢)
â”œâ”€â”€ PromptInputPanel (æç¤ºè¯è¾“å…¥é¢æ¿)
â”‚   â”œâ”€â”€ PromptEditor (æç¤ºè¯ç¼–è¾‘å™¨)
â”‚   â”œâ”€â”€ OptimizationOptions (ä¼˜åŒ–é€‰é¡¹)
â”‚   â””â”€â”€ ActionButtons (æ“ä½œæŒ‰é’®)
â”œâ”€â”€ OptimizationResultPanel (ä¼˜åŒ–ç»“æœé¢æ¿)
â”‚   â”œâ”€â”€ QualityScoreCard (è´¨é‡è¯„åˆ†å¡ç‰‡)
â”‚   â”œâ”€â”€ ImprovementList (æ”¹è¿›åˆ—è¡¨)
â”‚   â””â”€â”€ OptimizedPromptDisplay (ä¼˜åŒ–ç»“æœæ˜¾ç¤º)
â””â”€â”€ ComparisonView (å¯¹æ¯”è§†å›¾)
    â”œâ”€â”€ BeforeAfterLayout (å‰åå¸ƒå±€)
    â”œâ”€â”€ QualityComparison (è´¨é‡å¯¹æ¯”)
    â””â”€â”€ ChangeHighlighter (å˜åŒ–é«˜äº®)
```

## ğŸ“± åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 1. æç¤ºè¯è¾“å…¥ç»„ä»¶ (Day 1)

#### 1.1 PromptEditor æç¤ºè¯ç¼–è¾‘å™¨

**åŠŸèƒ½ç‰¹æ€§**:
- å¤šè¡Œæ–‡æœ¬è¾“å…¥ï¼Œæ”¯æŒè‡ªåŠ¨è°ƒæ•´é«˜åº¦
- å­—ç¬¦è®¡æ•°æ˜¾ç¤ºï¼Œå®æ—¶æ›´æ–°
- è¯­æ³•é«˜äº®ï¼ˆå¯é€‰ï¼‰
- å¿«æ·é”®æ”¯æŒï¼ˆCtrl+Enteræäº¤ï¼‰
- å†å²è¾“å…¥è®°å½•ï¼ˆä¸‹æ‹‰æç¤ºï¼‰

**æŠ€æœ¯å®ç°**:
```typescript
interface PromptEditorProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  maxLength?: number;
  showCharCount?: boolean;
  disabled?: boolean;
}

const PromptEditor: React.FC<PromptEditorProps> = ({
  value,
  onChange,
  placeholder = "è¯·è¾“å…¥æ‚¨çš„æç¤ºè¯...",
  maxLength = 10000,
  showCharCount = true,
  disabled = false
}) => {
  // å®ç°ç»†èŠ‚
}
```

**UIè®¾è®¡è§„èŒƒ**:
- æœ€å°é«˜åº¦: 120px
- æœ€å¤§é«˜åº¦: 400px  
- è¾¹æ¡†æ ·å¼: 1px solid #d9d9d9
- ç„¦ç‚¹çŠ¶æ€: è“è‰²è¾¹æ¡† #1890ff
- å­—ä½“: Monaco, 'Courier New', monospace
- å­—å·: 14px
- è¡Œé«˜: 1.5

#### 1.2 OptimizationOptions ä¼˜åŒ–é€‰é¡¹

**åŠŸèƒ½ç‰¹æ€§**:
- ä¼˜åŒ–ç±»å‹é€‰æ‹© (é€šç”¨/ä»£ç /å†™ä½œ/åˆ†æ)
- è¯¦ç»†ç¨‹åº¦é€‰æ‹© (å¿«é€Ÿ/æ ‡å‡†/è¯¦ç»†)
- ç›®æ ‡å—ä¼—è®¾ç½® (åˆå­¦è€…/ä¸“ä¸šäººå£«/ä¸“å®¶)
- ä¸ªæ€§åŒ–åå¥½è®¾ç½®

**é€‰é¡¹é…ç½®**:
```typescript
interface OptimizationConfig {
  type: 'general' | 'code' | 'writing' | 'analysis';
  level: 'quick' | 'standard' | 'detailed';
  audience: 'beginner' | 'professional' | 'expert';
  preferences: {
    language?: string;
    style?: string;
    format?: string;
  };
}
```

**UIç»„ä»¶è®¾è®¡**:
```typescript
const OptimizationOptions: React.FC<{
  config: OptimizationConfig;
  onChange: (config: OptimizationConfig) => void;
}> = ({ config, onChange }) => {
  return (
    <div className="optimization-options">
      <Row gutter={16}>
        <Col span={6}>
          <Select
            value={config.type}
            onChange={(type) => onChange({...config, type})}
            options={OPTIMIZATION_TYPES}
          />
        </Col>
        <Col span={6}>
          <Select
            value={config.level}
            onChange={(level) => onChange({...config, level})}
            options={OPTIMIZATION_LEVELS}
          />
        </Col>
        <Col span={6}>
          <Select
            value={config.audience}
            onChange={(audience) => onChange({...config, audience})}
            options={TARGET_AUDIENCES}
          />
        </Col>
        <Col span={6}>
          <Button 
            type="link" 
            onClick={showAdvancedSettings}
          >
            é«˜çº§è®¾ç½®
          </Button>
        </Col>
      </Row>
    </div>
  );
};
```

#### 1.3 ActionButtons æ“ä½œæŒ‰é’®

**æŒ‰é’®é…ç½®**:
- ä¸»è¦æ“ä½œ: "ä¼˜åŒ–æç¤ºè¯" (Primary Button)
- æ¬¡è¦æ“ä½œ: "é¢„è§ˆä¼˜åŒ–" (Default Button)  
- è¾…åŠ©æ“ä½œ: "æ¸…ç©ºè¾“å…¥" (Text Button)
- æ›´å¤šæ“ä½œ: "å¯¼å…¥ç¤ºä¾‹" (Dropdown Menu)

**çŠ¶æ€ç®¡ç†**:
```typescript
interface ActionState {
  isOptimizing: boolean;
  isPreviewLoading: boolean;
  canSubmit: boolean;
  hasContent: boolean;
}
```

### 2. ä¼˜åŒ–ç»“æœå±•ç¤ºç»„ä»¶ (Day 2)

#### 2.1 QualityScoreCard è´¨é‡è¯„åˆ†å¡ç‰‡

**åŠŸèƒ½ç‰¹æ€§**:
- æ€»ä½“è¯„åˆ†æ˜¾ç¤º (åœ†å½¢è¿›åº¦æ¡)
- å„ç»´åº¦è¯„åˆ† (é›·è¾¾å›¾/æ¡å½¢å›¾)
- è¯„åˆ†å˜åŒ–å¯¹æ¯” (å‰åå¯¹æ¯”)
- ç­‰çº§è¯„ä»·æ˜¾ç¤º (ä¼˜ç§€/è‰¯å¥½/ä¸­ç­‰/åŠæ ¼/éœ€æ”¹è¿›)

**æ•°æ®ç»“æ„**:
```typescript
interface QualityScore {
  overall: number;
  detailed: {
    clarity: number;
    completeness: number;
    structure: number;
    specificity: number;
    actionability: number;
  };
  grade: string;
  improvement: number;
}
```

**å¯è§†åŒ–ç»„ä»¶**:
```typescript
const QualityScoreCard: React.FC<{
  beforeScore?: QualityScore;
  afterScore: QualityScore;
  showComparison?: boolean;
}> = ({ beforeScore, afterScore, showComparison = false }) => {
  return (
    <Card title="è´¨é‡è¯„åˆ†" className="quality-score-card">
      <Row gutter={24}>
        <Col span={12}>
          <div className="score-circle">
            <Progress
              type="circle"
              percent={afterScore.overall * 10}
              format={(percent) => `${afterScore.overall}/10`}
            />
            <div className="score-grade">{afterScore.grade}</div>
          </div>
        </Col>
        <Col span={12}>
          <div className="detailed-scores">
            {Object.entries(afterScore.detailed).map(([key, value]) => (
              <div key={key} className="score-item">
                <span className="score-label">{SCORE_LABELS[key]}</span>
                <Progress
                  percent={value * 10}
                  showInfo={false}
                  strokeColor={getScoreColor(value)}
                />
                <span className="score-value">{value}/10</span>
              </div>
            ))}
          </div>
        </Col>
      </Row>
    </Card>
  );
};
```

#### 2.2 ImprovementList æ”¹è¿›åˆ—è¡¨

**åŠŸèƒ½ç‰¹æ€§**:
- æ”¹è¿›ç‚¹åˆ†ç±»æ˜¾ç¤º
- æ”¹è¿›å‰åæ–‡æœ¬å¯¹æ¯”
- æ”¹è¿›æ•ˆæœè¯´æ˜
- å¯å±•å¼€è¯¦æƒ…æŸ¥çœ‹

**æ•°æ®ç»“æ„**:
```typescript
interface Improvement {
  id: string;
  type: string;
  description: string;
  beforeText?: string;
  afterText?: string;
  category: 'structure' | 'clarity' | 'content' | 'format';
  impact: 'high' | 'medium' | 'low';
}
```

**ç»„ä»¶å®ç°**:
```typescript
const ImprovementList: React.FC<{
  improvements: Improvement[];
  expanded?: boolean;
}> = ({ improvements, expanded = false }) => {
  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());

  const toggleExpand = (id: string) => {
    const newExpanded = new Set(expandedItems);
    if (newExpanded.has(id)) {
      newExpanded.delete(id);
    } else {
      newExpanded.add(id);
    }
    setExpandedItems(newExpanded);
  };

  return (
    <div className="improvement-list">
      {improvements.map((improvement) => (
        <div key={improvement.id} className="improvement-item">
          <div className="improvement-header" onClick={() => toggleExpand(improvement.id)}>
            <Tag color={CATEGORY_COLORS[improvement.category]}>
              {improvement.type}
            </Tag>
            <span className="improvement-description">
              {improvement.description}
            </span>
            <Badge 
              count={IMPACT_LABELS[improvement.impact]} 
              style={{ backgroundColor: IMPACT_COLORS[improvement.impact] }}
            />
          </div>
          {expandedItems.has(improvement.id) && improvement.beforeText && (
            <div className="improvement-detail">
              <Descriptions size="small" column={1}>
                <Descriptions.Item label="ä¼˜åŒ–å‰">
                  <code>{improvement.beforeText}</code>
                </Descriptions.Item>
                <Descriptions.Item label="ä¼˜åŒ–å">
                  <code>{improvement.afterText}</code>
                </Descriptions.Item>
              </Descriptions>
            </div>
          )}
        </div>
      ))}
    </div>
  );
};
```

#### 2.3 OptimizedPromptDisplay ä¼˜åŒ–ç»“æœæ˜¾ç¤º

**åŠŸèƒ½ç‰¹æ€§**:
- ä¼˜åŒ–åæç¤ºè¯å®Œæ•´æ˜¾ç¤º
- ä»£ç é«˜äº®æ˜¾ç¤ºï¼ˆå¦‚æœæ˜¯ä»£ç ç±»å‹ï¼‰
- å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
- å¯¼å‡ºåŠŸèƒ½ï¼ˆæ–‡æœ¬/Markdownï¼‰
- è¿›ä¸€æ­¥ä¼˜åŒ–æŒ‰é’®

**ç»„ä»¶è®¾è®¡**:
```typescript
const OptimizedPromptDisplay: React.FC<{
  prompt: string;
  type: string;
  onCopy?: () => void;
  onExport?: (format: 'text' | 'markdown') => void;
  onFurtherOptimize?: () => void;
}> = ({ prompt, type, onCopy, onExport, onFurtherOptimize }) => {
  return (
    <Card 
      title="ä¼˜åŒ–ç»“æœ" 
      extra={
        <Space>
          <Button icon={<CopyOutlined />} onClick={onCopy}>
            å¤åˆ¶
          </Button>
          <Dropdown menu={{ items: exportMenuItems }}>
            <Button icon={<ExportOutlined />}>
              å¯¼å‡º
            </Button>
          </Dropdown>
          <Button type="primary" onClick={onFurtherOptimize}>
            è¿›ä¸€æ­¥ä¼˜åŒ–
          </Button>
        </Space>
      }
    >
      <div className="optimized-prompt-container">
        {type === 'code' ? (
          <SyntaxHighlighter
            language="python"
            style={githubGist}
            customStyle={{ background: '#fafafa' }}
          >
            {prompt}
          </SyntaxHighlighter>
        ) : (
          <pre className="prompt-text">{prompt}</pre>
        )}
      </div>
    </Card>
  );
};
```

### 3. å‰åå¯¹æ¯”ç•Œé¢ (Day 3)

#### 3.1 BeforeAfterLayout å‰åå¸ƒå±€

**å¸ƒå±€æ–¹æ¡ˆ**:
- å·¦å³åˆ†æ å¸ƒå±€ (50% / 50%)
- å“åº”å¼é€‚é… (ç§»åŠ¨ç«¯ä¸Šä¸‹å¸ƒå±€)
- åŒæ­¥æ»šåŠ¨æ”¯æŒ
- å¯è°ƒæ•´åˆ†æ æ¯”ä¾‹

**ç»„ä»¶å®ç°**:
```typescript
const BeforeAfterLayout: React.FC<{
  beforeContent: React.ReactNode;
  afterContent: React.ReactNode;
  direction?: 'horizontal' | 'vertical';
  syncScroll?: boolean;
}> = ({ 
  beforeContent, 
  afterContent, 
  direction = 'horizontal',
  syncScroll = true 
}) => {
  const [beforeScrollTop, setBeforeScrollTop] = useState(0);
  const [afterScrollTop, setAfterScrollTop] = useState(0);

  const handleScroll = (source: 'before' | 'after', scrollTop: number) => {
    if (syncScroll) {
      if (source === 'before') {
        setAfterScrollTop(scrollTop);
      } else {
        setBeforeScrollTop(scrollTop);
      }
    }
  };

  return (
    <div className={`before-after-layout ${direction}`}>
      <div className="before-panel">
        <div className="panel-header">
          <Tag color="orange">ä¼˜åŒ–å‰</Tag>
        </div>
        <div 
          className="panel-content"
          onScroll={(e) => handleScroll('before', e.currentTarget.scrollTop)}
          style={{ scrollTop: beforeScrollTop }}
        >
          {beforeContent}
        </div>
      </div>
      <div className="divider" />
      <div className="after-panel">
        <div className="panel-header">
          <Tag color="green">ä¼˜åŒ–å</Tag>
        </div>
        <div 
          className="panel-content"
          onScroll={(e) => handleScroll('after', e.currentTarget.scrollTop)}
          style={{ scrollTop: afterScrollTop }}
        >
          {afterContent}
        </div>
      </div>
    </div>
  );
};
```

#### 3.2 QualityComparison è´¨é‡å¯¹æ¯”

**å¯¹æ¯”ç»´åº¦**:
- æ€»ä½“è¯„åˆ†å¯¹æ¯”
- å„ç»´åº¦è¯„åˆ†å¯¹æ¯”  
- æ”¹è¿›å¹…åº¦ç»Ÿè®¡
- ä¼˜åŒ–æ•ˆæœè¯„ä»·

**å¯è§†åŒ–æ–¹æ¡ˆ**:
```typescript
const QualityComparison: React.FC<{
  beforeScore: QualityScore;
  afterScore: QualityScore;
}> = ({ beforeScore, afterScore }) => {
  const chartData = Object.keys(beforeScore.detailed).map(key => ({
    dimension: SCORE_LABELS[key],
    before: beforeScore.detailed[key],
    after: afterScore.detailed[key],
    improvement: afterScore.detailed[key] - beforeScore.detailed[key]
  }));

  return (
    <Card title="è´¨é‡å¯¹æ¯”åˆ†æ">
      <Row gutter={24}>
        <Col span={12}>
          <Statistic
            title="æ€»ä½“è¯„åˆ†æå‡"
            value={afterScore.overall - beforeScore.overall}
            precision={1}
            valueStyle={{ color: afterScore.overall > beforeScore.overall ? '#3f8600' : '#cf1322' }}
            prefix={afterScore.overall > beforeScore.overall ? <ArrowUpOutlined /> : <ArrowDownOutlined />}
            suffix="åˆ†"
          />
        </Col>
        <Col span={12}>
          <Statistic
            title="æ”¹è¿›æ•ˆæœ"
            value={((afterScore.overall - beforeScore.overall) / beforeScore.overall * 100)}
            precision={1}
            valueStyle={{ color: '#3f8600' }}
            suffix="%"
          />
        </Col>
      </Row>
      <div className="comparison-chart">
        <ResponsiveContainer width="100%" height={300}>
          <BarChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="dimension" />
            <YAxis domain={[0, 10]} />
            <Tooltip />
            <Legend />
            <Bar dataKey="before" fill="#ff7875" name="ä¼˜åŒ–å‰" />
            <Bar dataKey="after" fill="#73d13d" name="ä¼˜åŒ–å" />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </Card>
  );
};
```

#### 3.3 ChangeHighlighter å˜åŒ–é«˜äº®

**åŠŸèƒ½ç‰¹æ€§**:
- æ–‡æœ¬å·®å¼‚é«˜äº®æ˜¾ç¤º
- æ·»åŠ /åˆ é™¤/ä¿®æ”¹æ ‡è®°
- é€å¥å¯¹æ¯”æ¨¡å¼
- å˜åŒ–ç»Ÿè®¡ä¿¡æ¯

**æŠ€æœ¯å®ç°**:
```typescript
interface TextChange {
  type: 'added' | 'removed' | 'modified' | 'unchanged';
  text: string;
  line?: number;
  position?: number;
}

const ChangeHighlighter: React.FC<{
  beforeText: string;
  afterText: string;
  mode?: 'word' | 'line' | 'sentence';
}> = ({ beforeText, afterText, mode = 'sentence' }) => {
  const changes = useMemo(() => {
    return computeTextDiff(beforeText, afterText, mode);
  }, [beforeText, afterText, mode]);

  const renderChange = (change: TextChange, index: number) => {
    const className = `text-change text-change-${change.type}`;
    return (
      <span key={index} className={className} title={getChangeTooltip(change)}>
        {change.text}
      </span>
    );
  };

  return (
    <div className="change-highlighter">
      <div className="change-stats">
        <Space>
          <Tag color="green">
            æ–°å¢ {changes.filter(c => c.type === 'added').length}
          </Tag>
          <Tag color="red">
            åˆ é™¤ {changes.filter(c => c.type === 'removed').length}
          </Tag>
          <Tag color="orange">
            ä¿®æ”¹ {changes.filter(c => c.type === 'modified').length}
          </Tag>
        </Space>
      </div>
      <div className="change-content">
        {changes.map(renderChange)}
      </div>
    </div>
  );
};
```

## ğŸ”Œ API æ¥å£è®¾è®¡

### 1. æç¤ºè¯ä¼˜åŒ–æ¥å£

```typescript
// ä¼˜åŒ–è¯·æ±‚
interface OptimizationRequest {
  prompt: string;
  type: 'general' | 'code' | 'writing' | 'analysis';
  level: 'quick' | 'standard' | 'detailed';
  audience?: string;
  preferences?: Record<string, any>;
}

// ä¼˜åŒ–å“åº”
interface OptimizationResponse {
  id: string;
  originalPrompt: string;
  optimizedPrompt: string;
  qualityScoreBefore: number;
  qualityScoreAfter: number;
  detailedScores: {
    before: DetailedScores;
    after: DetailedScores;
  };
  improvements: Improvement[];
  processingTime: number;
  createdAt: string;
}

// APIè°ƒç”¨
export const optimizePrompt = async (request: OptimizationRequest): Promise<OptimizationResponse> => {
  const response = await api.post('/api/v1/optimizer/optimize', request);
  return response.data;
};
```

### 2. è´¨é‡è¯„ä¼°æ¥å£

```typescript
// è¯„ä¼°è¯·æ±‚
interface EvaluationRequest {
  prompt: string;
  mode?: 'quick' | 'comprehensive';
}

// è¯„ä¼°å“åº”
interface EvaluationResponse {
  overallScore: number;
  detailedScores: DetailedScores;
  issues: string[];
  suggestions: string[];
  grade: string;
  processingTime: number;
}

// APIè°ƒç”¨
export const evaluatePrompt = async (request: EvaluationRequest): Promise<EvaluationResponse> => {
  const response = await api.post('/api/v1/optimizer/evaluate', request);
  return response.data;
};
```

### 3. é¢„è§ˆä¼˜åŒ–æ¥å£

```typescript
// é¢„è§ˆè¯·æ±‚
interface PreviewRequest {
  prompt: string;
  type: string;
  preferences?: Record<string, any>;
}

// é¢„è§ˆå“åº”
interface PreviewResponse {
  currentAnalysis: {
    type: string;
    complexity: string;
    issues: string[];
    score: number;
  };
  recommendedStrategies: Array<{
    name: string;
    description: string;
    priority: number;
  }>;
  estimatedImprovement: number;
}

// APIè°ƒç”¨
export const previewOptimization = async (request: PreviewRequest): Promise<PreviewResponse> => {
  const response = await api.post('/api/v1/optimizer/preview', request);
  return response.data;
};
```

## ğŸ¨ UI/UX è®¾è®¡è§„èŒƒ

### 1. è‰²å½©è®¾è®¡

**ä¸»è‰²è°ƒ**:
- ä¸»è¦å“ç‰Œè‰²: #1890ff (Ant Design Blue)
- æˆåŠŸè‰²: #52c41a (Green 6)
- è­¦å‘Šè‰²: #faad14 (Gold 6)  
- é”™è¯¯è‰²: #f5222d (Red 6)
- æ–‡æœ¬è‰²: #262626 (Gray 13)

**è¯„åˆ†è‰²å½©**:
- ä¼˜ç§€ (9-10åˆ†): #52c41a (ç»¿è‰²)
- è‰¯å¥½ (8-9åˆ†): #73d13d (æµ…ç»¿)
- ä¸­ç­‰ (7-8åˆ†): #faad14 (é»„è‰²)
- åŠæ ¼ (6-7åˆ†): #fa8c16 (æ©™è‰²)
- éœ€æ”¹è¿› (<6åˆ†): #f5222d (çº¢è‰²)

### 2. å­—ä½“è®¾è®¡

**å­—ä½“æ—**:
- ä¸­æ–‡: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Hiragino Sans GB'
- ä»£ç : 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace
- æ•°å­—: 'SF Pro Display', -apple-system-body

**å­—ä½“å¤§å°**:
- é¡µé¢æ ‡é¢˜: 24px
- åŒºåŸŸæ ‡é¢˜: 18px  
- æ­£æ–‡æ–‡æœ¬: 14px
- è¾…åŠ©æ–‡æœ¬: 12px
- ä»£ç æ–‡æœ¬: 13px

### 3. é—´è·è®¾è®¡

**ç»„ä»¶é—´è·**:
- å¤§é—´è·: 24px (é¡µé¢çº§)
- ä¸­é—´è·: 16px (åŒºåŸŸçº§)
- å°é—´è·: 8px (å…ƒç´ çº§)
- å¾®é—´è·: 4px (ç»†èŠ‚çº§)

**å¸ƒå±€é—´è·**:
- é¡µé¢è¾¹è·: 24px
- å†…å®¹åŒºåŸŸ: 1200px max-width
- æ …æ ¼é—´è·: 16px

### 4. äº¤äº’è®¾è®¡

**åŠ¨ç”»æ•ˆæœ**:
- é¡µé¢è¿‡æ¸¡: 300ms ease-in-out
- ç»„ä»¶åŠ¨ç”»: 200ms ease
- å¾®äº¤äº’: 100ms ease

**åé¦ˆè®¾è®¡**:
- åŠ è½½çŠ¶æ€: Spinç»„ä»¶ + éª¨æ¶å±
- æˆåŠŸæç¤º: Messageç»„ä»¶ï¼Œ3ç§’è‡ªåŠ¨æ¶ˆå¤±
- é”™è¯¯æç¤º: Notificationç»„ä»¶ï¼Œæ‰‹åŠ¨å…³é—­
- ç¡®è®¤æ“ä½œ: Modalç»„ä»¶ï¼ŒäºŒæ¬¡ç¡®è®¤

## ğŸ“± å“åº”å¼è®¾è®¡

### 1. æ–­ç‚¹è®¾è®¡

```scss
$breakpoints: (
  xs: 0,      // æ‰‹æœºç«–å±
  sm: 576px,  // æ‰‹æœºæ¨ªå±
  md: 768px,  // å¹³æ¿ç«–å±
  lg: 992px,  // å¹³æ¿æ¨ªå±/å°æ¡Œé¢
  xl: 1200px, // æ¡Œé¢
  xxl: 1600px // å¤§å±æ¡Œé¢
);
```

### 2. å¸ƒå±€é€‚é…

**æ¡Œé¢ç«¯ (lg+)**:
- å·¦å³åˆ†æ å¸ƒå±€
- å›ºå®šä¾§è¾¹æ 
- å¤šåˆ—æ˜¾ç¤º

**å¹³æ¿ç«¯ (md-lg)**:
- ä¸Šä¸‹å¸ƒå±€
- æŠ˜å ä¾§è¾¹æ 
- åŒåˆ—æ˜¾ç¤º

**æ‰‹æœºç«¯ (xs-sm)**:
- å•åˆ—å¸ƒå±€
- å…¨å±æ˜¾ç¤º
- æ»‘åŠ¨å¯¼èˆª

### 3. ç»„ä»¶é€‚é…

```typescript
const useResponsive = () => {
  const [screenSize, setScreenSize] = useState<'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl'>('lg');
  
  useEffect(() => {
    const updateSize = () => {
      const width = window.innerWidth;
      if (width < 576) setScreenSize('xs');
      else if (width < 768) setScreenSize('sm');
      else if (width < 992) setScreenSize('md');
      else if (width < 1200) setScreenSize('lg');
      else if (width < 1600) setScreenSize('xl');
      else setScreenSize('xxl');
    };
    
    updateSize();
    window.addEventListener('resize', updateSize);
    return () => window.removeEventListener('resize', updateSize);
  }, []);
  
  return screenSize;
};
```

## ğŸ”§ çŠ¶æ€ç®¡ç†

### 1. å…¨å±€çŠ¶æ€è®¾è®¡

```typescript
interface OptimizationState {
  // å½“å‰è¾“å…¥
  currentPrompt: string;
  currentConfig: OptimizationConfig;
  
  // ä¼˜åŒ–ç»“æœ
  optimizationResult: OptimizationResponse | null;
  isOptimizing: boolean;
  optimizationError: string | null;
  
  // é¢„è§ˆæ•°æ®
  previewData: PreviewResponse | null;
  isPreviewLoading: boolean;
  
  // UIçŠ¶æ€
  activeTab: 'input' | 'result' | 'comparison';
  sidebarCollapsed: boolean;
  
  // ç”¨æˆ·åå¥½
  userPreferences: {
    theme: 'light' | 'dark';
    language: 'zh' | 'en';
    autoSave: boolean;
  };
}
```

### 2. çŠ¶æ€ç®¡ç†å™¨

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

export const useOptimizationStore = create<OptimizationState>()(
  persist(
    (set, get) => ({
      // åˆå§‹çŠ¶æ€
      currentPrompt: '',
      currentConfig: {
        type: 'general',
        level: 'standard',
        audience: 'professional',
        preferences: {}
      },
      optimizationResult: null,
      isOptimizing: false,
      optimizationError: null,
      previewData: null,
      isPreviewLoading: false,
      activeTab: 'input',
      sidebarCollapsed: false,
      userPreferences: {
        theme: 'light',
        language: 'zh',
        autoSave: true
      },

      // Actions
      setCurrentPrompt: (prompt: string) => 
        set({ currentPrompt: prompt }),
      
      setCurrentConfig: (config: OptimizationConfig) =>
        set({ currentConfig: config }),
      
      startOptimization: () =>
        set({ isOptimizing: true, optimizationError: null }),
      
      setOptimizationResult: (result: OptimizationResponse) =>
        set({ 
          optimizationResult: result, 
          isOptimizing: false,
          activeTab: 'result' 
        }),
      
      setOptimizationError: (error: string) =>
        set({ 
          optimizationError: error, 
          isOptimizing: false 
        }),
      
      clearOptimization: () =>
        set({ 
          optimizationResult: null, 
          optimizationError: null,
          activeTab: 'input'
        }),
      
      setActiveTab: (tab: 'input' | 'result' | 'comparison') =>
        set({ activeTab: tab }),
      
      toggleSidebar: () =>
        set((state) => ({ sidebarCollapsed: !state.sidebarCollapsed })),
      
      updateUserPreferences: (preferences: Partial<typeof get().userPreferences>) =>
        set((state) => ({
          userPreferences: { ...state.userPreferences, ...preferences }
        }))
    }),
    {
      name: 'optimization-storage',
      partialize: (state) => ({
        userPreferences: state.userPreferences,
        currentConfig: state.currentConfig
      })
    }
  )
);
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. ç»„ä»¶æµ‹è¯•

**æµ‹è¯•å·¥å…·**: Jest + React Testing Library

**æµ‹è¯•è¦†ç›–**:
- ç»„ä»¶æ¸²æŸ“æµ‹è¯•
- ç”¨æˆ·äº¤äº’æµ‹è¯•  
- çŠ¶æ€å˜æ›´æµ‹è¯•
- APIè°ƒç”¨æµ‹è¯•

```typescript
// ç¤ºä¾‹: PromptEditorç»„ä»¶æµ‹è¯•
describe('PromptEditor', () => {
  test('åº”è¯¥æ­£ç¡®æ¸²æŸ“ç¼–è¾‘å™¨', () => {
    render(
      <PromptEditor 
        value="" 
        onChange={jest.fn()} 
        placeholder="è¯·è¾“å…¥æç¤ºè¯" 
      />
    );
    
    expect(screen.getByPlaceholderText('è¯·è¾“å…¥æç¤ºè¯')).toBeInTheDocument();
  });

  test('åº”è¯¥åœ¨è¾“å…¥æ—¶è§¦å‘onChange', async () => {
    const handleChange = jest.fn();
    render(<PromptEditor value="" onChange={handleChange} />);
    
    const editor = screen.getByRole('textbox');
    await userEvent.type(editor, 'test prompt');
    
    expect(handleChange).toHaveBeenCalledWith('test prompt');
  });

  test('åº”è¯¥æ˜¾ç¤ºå­—ç¬¦è®¡æ•°', () => {
    render(
      <PromptEditor 
        value="hello world" 
        onChange={jest.fn()} 
        showCharCount={true} 
      />
    );
    
    expect(screen.getByText('11 / 10000')).toBeInTheDocument();
  });
});
```

### 2. é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- å®Œæ•´ä¼˜åŒ–æµç¨‹æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- å¯è®¿é—®æ€§æµ‹è¯•

### 3. E2Eæµ‹è¯•

**æµ‹è¯•å·¥å…·**: Playwright

**æµ‹è¯•ç”¨ä¾‹**:
- ç”¨æˆ·å®Œæ•´æ“ä½œæµç¨‹
- å¤šæµè§ˆå™¨å…¼å®¹æ€§
- ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ä»£ç åˆ†å‰²

```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const OptimizationPage = lazy(() => import('../pages/OptimizationPage'));
const HistoryPage = lazy(() => import('../pages/HistoryPage'));

// ç»„ä»¶çº§åˆ«ä»£ç åˆ†å‰²
const AdvancedSettings = lazy(() => import('../components/AdvancedSettings'));
```

### 2. æ•°æ®ç¼“å­˜

```typescript
// React Queryé…ç½®
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
      cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ
      refetchOnWindowFocus: false,
    },
  },
});

// APIç¼“å­˜ç­–ç•¥
export const useOptimizationQuery = (request: OptimizationRequest) => {
  return useQuery({
    queryKey: ['optimization', request],
    queryFn: () => optimizePrompt(request),
    enabled: !!request.prompt,
    staleTime: 0, // ä¼˜åŒ–ç»“æœä¸ä½¿ç”¨ç¼“å­˜
  });
};
```

### 3. ç»„ä»¶ä¼˜åŒ–

```typescript
// ä½¿ç”¨memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const PromptEditor = memo<PromptEditorProps>(({ value, onChange, ...props }) => {
  // ä½¿ç”¨useCallbackç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
  const handleChange = useCallback((newValue: string) => {
    onChange(newValue);
  }, [onChange]);

  // ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
  const charCount = useMemo(() => value.length, [value]);

  return (
    // ç»„ä»¶JSX
  );
});
```

## ğŸ” å®‰å…¨è€ƒè™‘

### 1. è¾“å…¥éªŒè¯

```typescript
// å®¢æˆ·ç«¯éªŒè¯
const validatePrompt = (prompt: string): string[] => {
  const errors: string[] = [];
  
  if (!prompt.trim()) {
    errors.push('æç¤ºè¯ä¸èƒ½ä¸ºç©º');
  }
  
  if (prompt.length > 10000) {
    errors.push('æç¤ºè¯é•¿åº¦ä¸èƒ½è¶…è¿‡10000å­—ç¬¦');
  }
  
  // XSSé˜²æŠ¤
  if (/<script|javascript:|data:|vbscript:/i.test(prompt)) {
    errors.push('æç¤ºè¯åŒ…å«ä¸å®‰å…¨å†…å®¹');
  }
  
  return errors;
};
```

### 2. APIå®‰å…¨

```typescript
// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    // æ·»åŠ è®¤è¯å¤´
    const token = localStorage.getItem('auth_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    
    // æ·»åŠ CSRFä¿æŠ¤
    config.headers['X-Requested-With'] = 'XMLHttpRequest';
    
    return config;
  },
  (error) => Promise.reject(error)
);

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // å¤„ç†è®¤è¯å¤±æ•ˆ
      localStorage.removeItem('auth_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

## ğŸ“‹ å¼€å‘è®¡åˆ’

### Day 1: æç¤ºè¯è¾“å…¥ç»„ä»¶

**ä¸Šåˆ (4å°æ—¶)**:
- [ ] æ­å»ºåŸºç¡€é¡µé¢ç»“æ„
- [ ] å®ç°PromptEditorç»„ä»¶
- [ ] æ·»åŠ å­—ç¬¦è®¡æ•°å’ŒéªŒè¯

**ä¸‹åˆ (4å°æ—¶)**:
- [ ] å®ç°OptimizationOptionsç»„ä»¶
- [ ] å®ç°ActionButtonsç»„ä»¶
- [ ] ç»„ä»¶é›†æˆå’Œè”è°ƒæµ‹è¯•

### Day 2: ä¼˜åŒ–ç»“æœå±•ç¤ºç»„ä»¶

**ä¸Šåˆ (4å°æ—¶)**:
- [ ] å®ç°QualityScoreCardç»„ä»¶
- [ ] é›†æˆå›¾è¡¨åº“å’Œå¯è§†åŒ–
- [ ] å®ç°è¯„åˆ†åŠ¨ç”»æ•ˆæœ

**ä¸‹åˆ (4å°æ—¶)**:
- [ ] å®ç°ImprovementListç»„ä»¶
- [ ] å®ç°OptimizedPromptDisplayç»„ä»¶
- [ ] æ·»åŠ å¤åˆ¶å’Œå¯¼å‡ºåŠŸèƒ½

### Day 3: å‰åå¯¹æ¯”ç•Œé¢

**ä¸Šåˆ (4å°æ—¶)**:
- [ ] å®ç°BeforeAfterLayoutç»„ä»¶
- [ ] å®ç°QualityComparisonç»„ä»¶
- [ ] æ·»åŠ å›¾è¡¨å¯è§†åŒ–

**ä¸‹åˆ (4å°æ—¶)**:
- [ ] å®ç°ChangeHighlighterç»„ä»¶
- [ ] æ–‡æœ¬å·®å¼‚ç®—æ³•å®ç°
- [ ] æ•´ä½“ç•Œé¢ä¼˜åŒ–å’Œæµ‹è¯•

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

1. **æç¤ºè¯è¾“å…¥åŠŸèƒ½**:
   - [ ] æ”¯æŒå¤šè¡Œæ–‡æœ¬è¾“å…¥ï¼Œè‡ªåŠ¨è°ƒæ•´é«˜åº¦
   - [ ] æ˜¾ç¤ºå­—ç¬¦è®¡æ•°ï¼Œè¶…å‡ºé™åˆ¶æ—¶æç¤º
   - [ ] ä¼˜åŒ–é€‰é¡¹å¯ä»¥æ­£ç¡®è®¾ç½®å’Œä¿å­˜
   - [ ] æ“ä½œæŒ‰é’®çŠ¶æ€æ­£ç¡®å“åº”

2. **ç»“æœå±•ç¤ºåŠŸèƒ½**:
   - [ ] è´¨é‡è¯„åˆ†æ­£ç¡®æ˜¾ç¤ºï¼ŒåŒ…å«æ€»åˆ†å’Œè¯¦ç»†åˆ†
   - [ ] æ”¹è¿›åˆ—è¡¨æ¸…æ™°å±•ç¤ºï¼Œæ”¯æŒå±•å¼€è¯¦æƒ…
   - [ ] ä¼˜åŒ–ç»“æœå®Œæ•´æ˜¾ç¤ºï¼Œæ”¯æŒå¤åˆ¶å¯¼å‡º
   - [ ] å›¾è¡¨å’Œå¯è§†åŒ–æ­£ç¡®æ¸²æŸ“

3. **å¯¹æ¯”å±•ç¤ºåŠŸèƒ½**:
   - [ ] å‰åå¯¹æ¯”å¸ƒå±€æ­£ç¡®ï¼Œæ”¯æŒåŒæ­¥æ»šåŠ¨
   - [ ] è´¨é‡å¯¹æ¯”å›¾è¡¨å‡†ç¡®æ˜¾ç¤ºå·®å¼‚
   - [ ] æ–‡æœ¬å˜åŒ–é«˜äº®æ­£ç¡®æ ‡è¯†å·®å¼‚
   - [ ] å“åº”å¼å¸ƒå±€åœ¨ä¸åŒè®¾å¤‡æ­£å¸¸æ˜¾ç¤º

### æŠ€æœ¯éªŒæ”¶

1. **ä»£ç è´¨é‡**:
   - [ ] TypeScriptç±»å‹å®šä¹‰å®Œæ•´
   - [ ] ç»„ä»¶propsæ¥å£è§„èŒƒ
   - [ ] ä»£ç æ³¨é‡Šæ¸…æ™°å®Œæ•´
   - [ ] ESLintæ£€æŸ¥æ— é”™è¯¯

2. **æ€§èƒ½æŒ‡æ ‡**:
   - [ ] é¡µé¢é¦–æ¬¡åŠ è½½æ—¶é—´ < 3ç§’
   - [ ] ç»„ä»¶äº¤äº’å“åº”æ—¶é—´ < 200ms
   - [ ] å†…å­˜ä½¿ç”¨åˆç†ï¼Œæ— æ˜æ˜¾æ³„æ¼
   - [ ] æ‰“åŒ…ä½“ç§¯æ§åˆ¶åœ¨åˆç†èŒƒå›´

3. **å…¼å®¹æ€§æµ‹è¯•**:
   - [ ] Chrome/Firefox/Safari/Edgeæ­£å¸¸æ˜¾ç¤º
   - [ ] ç§»åŠ¨ç«¯Chrome/Safariæ­£å¸¸æ˜¾ç¤º
   - [ ] ä¸åŒå±å¹•åˆ†è¾¨ç‡é€‚é…è‰¯å¥½
   - [ ] æ”¯æŒé”®ç›˜å¯¼èˆªå’Œæ— éšœç¢è®¿é—®

### ç”¨æˆ·ä½“éªŒéªŒæ”¶

1. **æ˜“ç”¨æ€§**:
   - [ ] æ“ä½œæµç¨‹ç›´è§‚ï¼Œç¬¦åˆç”¨æˆ·ä¹ æƒ¯
   - [ ] åé¦ˆä¿¡æ¯åŠæ—¶å‡†ç¡®
   - [ ] é”™è¯¯å¤„ç†å‹å¥½ï¼Œæä¾›æ˜ç¡®æŒ‡å¯¼
   - [ ] ç•Œé¢å¸ƒå±€åˆç†ï¼Œä¿¡æ¯å±‚æ¬¡æ¸…æ™°

2. **ç¾è§‚æ€§**:
   - [ ] è§†è§‰è®¾è®¡ç¬¦åˆè®¾è®¡è§„èŒƒ
   - [ ] è‰²å½©æ­é…å’Œè°ç»Ÿä¸€
   - [ ] åŠ¨ç”»æ•ˆæœè‡ªç„¶æµç•…
   - [ ] ç»†èŠ‚å¤„ç†ç²¾è‡´å®Œå–„

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç¼–å†™è€…**: AI Assistant  
**å®¡æ ¸è€…**: å¾…å®š  
**æ‰¹å‡†è€…**: å¾…å®š  
**ç”Ÿæ•ˆæ—¥æœŸ**: 2024å¹´12æœˆ 